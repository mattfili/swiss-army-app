'use strict';

angular.module('swiss').factory('Weather', function (WeatherData, $http, $stateParams, WEATHER_URL) {
  return {

    date: function date() {
      var day = new Date().toDateString().substring(0, 3);
      var month = new Date().toDateString().substring(3);
      if (day === 'Tue') {
        day = 'Tuesday';
      } else if (day === 'Wed') {
        day = 'Wednesday';
      } else if (day === 'Thur') {
        day = 'Thursday';
      } else if (day === 'Fri') {
        day = 'Friday';
      } else if (day === 'Sat') {
        day = 'Saturday';
      } else if (day === 'Sun') {
        day = 'Sunday';
      } else if (day === 'Mon') {
        day = 'Monday';
      }
      var datemonth = day + ',' + month;

      WeatherData.formatdate = datemonth;
    },

    getWeather: function getWeather() {
      $http.jsonp(WEATHER_URL + $stateParams.lat + ',' + $stateParams.long + '?callback=JSON_CALLBACK').success(function (data) {

        WeatherData.dataPush(data.currently, data.daily, data.hourly);

        var iconFrame = data.hourly.data;

        for (var i = 0; i < iconFrame.length; i++) if (iconFrame[i].icon === 'clear-day') {
          WeatherData.iconPush('sun.svg', i);
        } else if (iconFrame[i].icon === 'clear-night') {
          WeatherData.iconPush('moonPhase.svg', i);
        } else if (iconFrame[i].icon === 'rain' && iconFrame[i].summary === 'Rain') {
          WeatherData.iconPush('cloudRain.svg', i);
        } else if (iconFrame[i].summary === 'Light Rain') {
          WeatherData.iconPush('cloudDrizzleAlt.svg', i);
        } else if (iconFrame[i].icon === 'rain' && iconFrame[i].summary === 'Drizzle') {
          WeatherData.iconPush('cloudDrizzle.svg', i);
        } else if (iconFrame[i].icon === 'snow') {
          WeatherData.iconPush('cloudSnow.svg', i);
        } else if (iconFrame[i].icon === 'sleet') {
          WeatherData.iconPush('cloudSnowAlt.svg', i);
        } else if (iconFrame[i].icon === 'wind') {
          WeatherData.iconPush('wind.svg', i);
        } else if (iconFrame[i].icon === 'fog') {
          WeatherData.iconPush('cloudFog.svg', i);
        } else if (iconFrame[i].icon === 'cloudy') {
          WeatherData.iconPush('cloud.svg', i);
        } else if (iconFrame[i].icon === 'partly-cloudy-day') {
          WeatherData.iconPush('cloudSun.svg', i);
        } else if (iconFrame[i].icon === 'partly-cloudy-night') {
          WeatherData.iconPush('cloudMoon.svg', i);
        }

        var colorTime = data.hourly.data;

        for (var i = 0; i < colorTime.length; i++) {
          var unUnixDate = new Date(colorTime[i].time * 1000);
          var formattedDate = unUnixDate.getHours();

          if (formattedDate >= 0 && formattedDate <= 2 || formattedDate === 23) {
            WeatherData.colorPush('#071826', i);
          } else if (formattedDate >= 3 && formattedDate <= 5) {
            WeatherData.colorPush('#071940', i);
          } else if (formattedDate === 6) {
            WeatherData.colorPush('#FA6551', i);
          } else if (formattedDate >= 7 && formattedDate <= 11) {
            WeatherData.colorPush('#2A91CF', i);
          } else if (formattedDate >= 12 && formattedDate <= 15) {
            WeatherData.colorPush('#9DDEFF', i);
          } else if (formattedDate >= 16 && formattedDate <= 18) {
            WeatherData.colorPush('#2A91CF', i);
          } else if (formattedDate === 19) {
            WeatherData.colorPush('#FA6A67', i);
          } else if (formattedDate >= 20 && formattedDate <= 22) {
            WeatherData.colorPush('#133778', i);
          }
        }
      });
    }

  };
}).filter('Time', function () {
  return function (input) {
    var unUnixDate = new Date(input * 1000);
    var formattedDate = unUnixDate.getHours();
    if (formattedDate <= 23 && formattedDate >= 13) {
      var output = formattedDate - 12 + 'pm';
    } else if (formattedDate === 0) {
      var output = formattedDate + 12 + 'am';
    } else if (formattedDate === 12) {
      var output = formattedDate + 'pm';
    } else {
      var output = formattedDate + 'am';
    }
    return output;
  };
}).filter('Percent', function () {
  return function (input) {
    var output = input * 100;
    return output + '%';
    console.log(output);
  };
}).factory('Hacker', function ($http, paperBoy, $stateParams) {
  return {
    topNews: function topNews() {
      $http.get('https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty').then(function (result) {
        var idArray = result.data;
        angular.forEach(idArray, function (storyId, i) {
          if (i > 25) {
            return;
          }
          $http.get('https://hacker-news.firebaseio.com/v0/item/' + storyId + '.json?print=pretty').success(function (story) {
            paperBoy.dataPush(story);
          });
        });
      });
    },
    askStories: function askStories() {
      $http.get('https://hacker-news.firebaseio.com/v0/askstories.json?print=pretty').then(function (result) {
        var idArray = result.data;
        angular.forEach(idArray, function (storyId, i) {
          if (i > 25) {
            return;
          }
          $http.get('https://hacker-news.firebaseio.com/v0/item/' + storyId + '.json?print=pretty').success(function (ask) {
            paperBoy.askPush(ask);
          });
        });
      });
    },
    showStories: function showStories() {
      $http.get('https://hacker-news.firebaseio.com/v0/showstories.json?print=pretty').then(function (result) {
        var idArray = result.data;
        angular.forEach(idArray, function (storyId, i) {
          if (i > 25) {
            return;
          }
          $http.get('https://hacker-news.firebaseio.com/v0/item/' + storyId + '.json?print=pretty').success(function (show) {
            paperBoy.showPush(show);
          });
        });
      });
    }
  };
}).factory('Auth', function (FIRE_URL, $firebaseAuth) {
  var ref = new Firebase(FIRE_URL);
  return $firebaseAuth(ref);
}).factory('FB', function (FIRE_URL, $firebaseObject) {
  var ref = new Firebase(FIRE_URL);
  var favoriteRef = ref.child('/favorite');
  return $firebaseObject(favoriteRef);
});
//# sourceMappingURL=data:application/json;base64,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Q0FBQyxDQUFDO0NBQ3ZDLENBQUMsQ0FBQSIsImZpbGUiOiJzcmMvanMvZmFjdG9yeS5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzd2lzcycpXG5cbi5mYWN0b3J5KCdXZWF0aGVyJywgZnVuY3Rpb24gKCBXZWF0aGVyRGF0YSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgV0VBVEhFUl9VUkwpIHtcbnJldHVybiB7XG5cbiAgZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRheSA9IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDMpXG4gICAgdmFyIG1vbnRoID0gbmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKS5zdWJzdHJpbmcoMylcbiAgICBpZiAoZGF5ID09PSAnVHVlJykge1xuICAgICAgZGF5ID0gJ1R1ZXNkYXknXG4gICAgfSBlbHNlIGlmIChkYXkgPT09J1dlZCcpIHtcbiAgICAgIGRheSA9ICdXZWRuZXNkYXknXG4gICAgfSBlbHNlIGlmIChkYXkgPT09J1RodXInKSB7XG4gICAgICBkYXkgPSAnVGh1cnNkYXknXG4gICAgfSBlbHNlIGlmIChkYXkgPT09J0ZyaScpIHtcbiAgICAgIGRheSA9ICdGcmlkYXknXG4gICAgfSBlbHNlIGlmIChkYXkgPT09J1NhdCcpIHtcbiAgICAgIGRheSA9ICdTYXR1cmRheSdcbiAgICB9IGVsc2UgaWYgKGRheSA9PT0nU3VuJykge1xuICAgICAgZGF5ID0gJ1N1bmRheSdcbiAgICB9IGVsc2UgaWYgKGRheSA9PT0nTW9uJykge1xuICAgICAgZGF5ID0gJ01vbmRheSdcbiAgICB9XG4gICAgdmFyIGRhdGVtb250aCA9IGRheSArICcsJyArIG1vbnRoXG5cbiAgICBXZWF0aGVyRGF0YS5mb3JtYXRkYXRlID0gZGF0ZW1vbnRoXG4gIH0sXG5cbiAgZ2V0V2VhdGhlcjogZnVuY3Rpb24oKSB7XG4gICAgJGh0dHBcbiAgICAgIC5qc29ucChXRUFUSEVSX1VSTCArICRzdGF0ZVBhcmFtcy5sYXQgKyAnLCcgKyAkc3RhdGVQYXJhbXMubG9uZyArICc/Y2FsbGJhY2s9SlNPTl9DQUxMQkFDSycpXG4gICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSl7XG5cbiAgICAgICAgV2VhdGhlckRhdGEuZGF0YVB1c2goZGF0YS5jdXJyZW50bHksIGRhdGEuZGFpbHksIGRhdGEuaG91cmx5KSBcbiAgICAgICAgXG4gICAgICAgIHZhciBpY29uRnJhbWUgPSBkYXRhLmhvdXJseS5kYXRhXG5cblxuXG4gICAgICAgIGZvciAodmFyIGkgPTA7IGkgPCBpY29uRnJhbWUubGVuZ3RoOyBpKyspXG5cbiAgICAgICAgICBpZiAoaWNvbkZyYW1lW2ldLmljb24gID09PSAnY2xlYXItZGF5Jykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ3N1bi5zdmcnLCBpKVxuXG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uRnJhbWVbaV0uaWNvbiA9PT0nY2xlYXItbmlnaHQnKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnbW9vblBoYXNlLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdyYWluJyAmJiBpY29uRnJhbWVbaV0uc3VtbWFyeT09PSdSYWluJykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkUmFpbi5zdmcnLCBpKVxuXG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uRnJhbWVbaV0uc3VtbWFyeSA9PT0gJ0xpZ2h0IFJhaW4nKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnY2xvdWREcml6emxlQWx0LnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSAncmFpbicgJiYgaWNvbkZyYW1lW2ldLnN1bW1hcnk9PT0nRHJpenpsZScpIHtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmljb25QdXNoKCdjbG91ZERyaXp6bGUuc3ZnJywgaSlcblxuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbkZyYW1lW2ldLmljb24gPT09J3Nub3cnKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnY2xvdWRTbm93LnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdzbGVldCcpIHtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmljb25QdXNoKCdjbG91ZFNub3dBbHQuc3ZnJywgaSlcblxuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbkZyYW1lW2ldLmljb24gPT09J3dpbmQnKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnd2luZC5zdmcnLCBpKVxuXG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uRnJhbWVbaV0uaWNvbiA9PT0nZm9nJykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkRm9nLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdjbG91ZHknKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnY2xvdWQuc3ZnJywgaSlcblxuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbkZyYW1lW2ldLmljb24gPT09J3BhcnRseS1jbG91ZHktZGF5Jykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkU3VuLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdwYXJ0bHktY2xvdWR5LW5pZ2h0Jykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkTW9vbi5zdmcnLCBpKVxuICAgICAgICAgIH1cblxuICAgICAgICBcblxuICAgICAgICB2YXIgY29sb3JUaW1lID0gZGF0YS5ob3VybHkuZGF0YVxuXG4gICAgICAgIGZvciAodmFyIGk9MDsgaSA8IGNvbG9yVGltZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciB1blVuaXhEYXRlID0gbmV3IERhdGUoY29sb3JUaW1lW2ldLnRpbWUgKjEwMDApXG4gICAgICAgICAgdmFyIGZvcm1hdHRlZERhdGUgPSB1blVuaXhEYXRlLmdldEhvdXJzKCk7XG5cbiAgICAgICAgaWYgKGZvcm1hdHRlZERhdGUgPj0gMCAmJiBmb3JtYXR0ZWREYXRlIDw9MiB8fCBmb3JtYXR0ZWREYXRlID09PSAyMykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuY29sb3JQdXNoKCcjMDcxODI2JywgaSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXR0ZWREYXRlID49MyAmJiBmb3JtYXR0ZWREYXRlIDw9IDUpe1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuY29sb3JQdXNoKCcjMDcxOTQwJywgaSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXR0ZWREYXRlID09PSA2ICl7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5jb2xvclB1c2goJyNGQTY1NTEnLCBpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdHRlZERhdGUgPj0gNyAmJiBmb3JtYXR0ZWREYXRlIDw9MTEgKXtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmNvbG9yUHVzaCgnIzJBOTFDRicsIGkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA+PSAxMiAmJiBmb3JtYXR0ZWREYXRlIDw9IDE1KXtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmNvbG9yUHVzaCgnIzlEREVGRicsIGkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA+PSAxNiAmJiBmb3JtYXR0ZWREYXRlIDw9IDE4KXtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmNvbG9yUHVzaCgnIzJBOTFDRicsIGkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA9PT0gMTkpe1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuY29sb3JQdXNoKCcjRkE2QTY3JywgaSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXR0ZWREYXRlID49IDIwICYmIGZvcm1hdHRlZERhdGUgPD0gMjIpe1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuY29sb3JQdXNoKCcjMTMzNzc4JywgaSk7XG4gICAgICAgICAgfSBcbiAgICAgIH1cblxuICAgIH0pXG5cblxuICB9XG5cbn1cbn0pXG5cbi5maWx0ZXIoJ1RpbWUnLCBmdW5jdGlvbiAoKSB7XG5yZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICB2YXIgdW5Vbml4RGF0ZSA9IG5ldyBEYXRlKGlucHV0KjEwMDApXG4gICAgdmFyIGZvcm1hdHRlZERhdGUgPSB1blVuaXhEYXRlLmdldEhvdXJzKCk7XG4gICAgICBpZiAoZm9ybWF0dGVkRGF0ZSA8PSAyMyAmJiBmb3JtYXR0ZWREYXRlID49IDEzKSB7XG4gICAgICAgIHZhciBvdXRwdXQgPSBmb3JtYXR0ZWREYXRlLTEyICsgJ3BtJ1xuICAgICAgfSBlbHNlIGlmIChmb3JtYXR0ZWREYXRlID09PSAwKXtcbiAgICAgICAgdmFyIG91dHB1dCA9IGZvcm1hdHRlZERhdGUrMTIgKyAnYW0nXG4gICAgICB9IGVsc2UgaWYgKGZvcm1hdHRlZERhdGUgPT09IDEyKXtcbiAgICAgICAgdmFyIG91dHB1dCA9IGZvcm1hdHRlZERhdGUgKyAncG0nXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgb3V0cHV0ID0gZm9ybWF0dGVkRGF0ZSArICdhbSdcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxufSlcblxuLmZpbHRlcignUGVyY2VudCcsIGZ1bmN0aW9uICgpIHtcbnJldHVybiBmdW5jdGlvbihpbnB1dCkge1xuICAgIHZhciBvdXRwdXQgPSBpbnB1dCAqIDEwMFxuICAgIHJldHVybiBvdXRwdXQgKyAnJSdcbiAgICBjb25zb2xlLmxvZyhvdXRwdXQpXG59XG59KVxuXG4uZmFjdG9yeSgnSGFja2VyJywgZnVuY3Rpb24gKCRodHRwLCBwYXBlckJveSwgJHN0YXRlUGFyYW1zKSB7XG4gIHJldHVybiB7XG4gICAgdG9wTmV3czogZnVuY3Rpb24gKCkge1xuICAgICAgJGh0dHBcbiAgICAgIC5nZXQoJ2h0dHBzOi8vaGFja2VyLW5ld3MuZmlyZWJhc2Vpby5jb20vdjAvdG9wc3Rvcmllcy5qc29uP3ByaW50PXByZXR0eScpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgdmFyIGlkQXJyYXkgPSByZXN1bHQuZGF0YVxuICAgICAgICBhbmd1bGFyLmZvckVhY2goaWRBcnJheSwgZnVuY3Rpb24gKHN0b3J5SWQsIGkpIHtcbiAgICAgICAgICBpZiAoaSA+IDI1KSB7cmV0dXJufVxuICAgICAgICAgICRodHRwLmdldCgnaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9pdGVtLycgKyBzdG9yeUlkICsgJy5qc29uP3ByaW50PXByZXR0eScpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzdG9yeSkge1xuICAgICAgICAgICAgICBwYXBlckJveS5kYXRhUHVzaChzdG9yeSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0sXG4gICAgYXNrU3RvcmllczogZnVuY3Rpb24gKCkge1xuICAgICAgJGh0dHBcbiAgICAgIC5nZXQoJ2h0dHBzOi8vaGFja2VyLW5ld3MuZmlyZWJhc2Vpby5jb20vdjAvYXNrc3Rvcmllcy5qc29uP3ByaW50PXByZXR0eScpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgdmFyIGlkQXJyYXkgPSByZXN1bHQuZGF0YVxuICAgICAgICBhbmd1bGFyLmZvckVhY2goaWRBcnJheSwgZnVuY3Rpb24gKHN0b3J5SWQsIGkpIHtcbiAgICAgICAgICBpZiAoaSA+IDI1KSB7cmV0dXJufVxuICAgICAgICAgICRodHRwLmdldCgnaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9pdGVtLycgKyBzdG9yeUlkICsgJy5qc29uP3ByaW50PXByZXR0eScpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihhc2spIHtcbiAgICAgICAgICAgICAgcGFwZXJCb3kuYXNrUHVzaChhc2spXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9LFxuICAgIHNob3dTdG9yaWVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAkaHR0cFxuICAgICAgLmdldCgnaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9zaG93c3Rvcmllcy5qc29uP3ByaW50PXByZXR0eScpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgdmFyIGlkQXJyYXkgPSByZXN1bHQuZGF0YVxuICAgICAgICBhbmd1bGFyLmZvckVhY2goaWRBcnJheSwgZnVuY3Rpb24gKHN0b3J5SWQsIGkpIHtcbiAgICAgICAgICBpZiAoaSA+IDI1KSB7cmV0dXJufVxuICAgICAgICAgICRodHRwLmdldCgnaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9pdGVtLycgKyBzdG9yeUlkICsgJy5qc29uP3ByaW50PXByZXR0eScpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzaG93KSB7XG4gICAgICAgICAgICAgIHBhcGVyQm95LnNob3dQdXNoKHNob3cpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pXG4uZmFjdG9yeSgnQXV0aCcsIGZ1bmN0aW9uIChGSVJFX1VSTCwgJGZpcmViYXNlQXV0aCkge1xuICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRV9VUkwpO1xuICAgIHJldHVybiAkZmlyZWJhc2VBdXRoKHJlZik7XG59KVxuXG4uZmFjdG9yeSgnRkInLCBmdW5jdGlvbiAoRklSRV9VUkwsICRmaXJlYmFzZU9iamVjdCkge1xuICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRV9VUkwpO1xuICAgIHZhciBmYXZvcml0ZVJlZiA9IHJlZi5jaGlsZCgnL2Zhdm9yaXRlJylcbiAgICByZXR1cm4gJGZpcmViYXNlT2JqZWN0KGZhdm9yaXRlUmVmKTtcbn0pIl19
