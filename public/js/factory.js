'use strict';

angular.module('swiss').factory('Weather', function (WeatherData, $http, $stateParams, WEATHER_URL) {
  return {

    date: function date() {
      var day = new Date().toDateString().substring(0, 3);
      var month = new Date().toDateString().substring(3);
      if (day === 'Tue') {
        day = 'Tuesday';
      } else if (day === 'Wed') {
        day = 'Wednesday';
      } else if (day === 'Thur') {
        day = 'Thursday';
      } else if (day === 'Fri') {
        day = 'Friday';
      } else if (day === 'Sat') {
        day = 'Saturday';
      } else if (day === 'Sun') {
        day = 'Sunday';
      } else if (day === 'Mon') {
        day = 'Monday';
      }
      var datemonth = day + ',' + month;

      WeatherData.formatdate = datemonth;
    },

    getWeather: function getWeather() {
      $http.jsonp(WEATHER_URL + $stateParams.lat + ',' + $stateParams.long + '?callback=JSON_CALLBACK').success(function (data) {

        WeatherData.dataPush(data.currently, data.daily, data.hourly);

        var iconFrame = data.hourly.data;

        for (var i = 0; i < iconFrame.length; i++) if (iconFrame[i].icon === 'clear-day') {
          WeatherData.iconPush('sun.svg', i);
        } else if (iconFrame[i].icon === 'clear-night') {
          WeatherData.iconPush('moon.svg', i);
        } else if (iconFrame[i].icon === 'rain' && iconFrame[i].summary === 'Rain') {
          WeatherData.iconPush('cloudRain.svg', i);
        } else if (iconFrame[i].summary === 'Light Rain') {
          WeatherData.iconPush('cloudDrizzleAlt.svg', i);
        } else if (iconFrame[i].icon === 'rain' && iconFrame[i].summary === 'Drizzle') {
          WeatherData.iconPush('cloudDrizzle.svg', i);
        } else if (iconFrame[i].icon === 'snow') {
          WeatherData.iconPush('cloudSnow.svg', i);
        } else if (iconFrame[i].icon === 'sleet') {
          WeatherData.iconPush('cloudSnowAlt.svg', i);
        } else if (iconFrame[i].icon === 'wind') {
          WeatherData.iconPush('wind.svg', i);
        } else if (iconFrame[i].icon === 'fog') {
          WeatherData.iconPush('cloudFog.svg', i);
        } else if (iconFrame[i].icon === 'cloudy') {
          WeatherData.iconPush('cloud.svg', i);
        } else if (iconFrame[i].icon === 'partly-cloudy-day') {
          WeatherData.iconPush('cloudSun.svg', i);
        } else if (iconFrame[i].icon === 'partly-cloudy-night') {
          WeatherData.iconPush('cloudMoon.svg', i);
        }

        var colorTime = data.hourly.data;

        for (var i = 0; i < colorTime.length; i++) {
          var unUnixDate = new Date(colorTime[i].time * 1000);
          var formattedDate = unUnixDate.getHours();

          if (formattedDate >= 0 && formattedDate <= 2 || formattedDate === 23) {
            WeatherData.colorPush('#071826', i);
          } else if (formattedDate >= 3 && formattedDate <= 5) {
            WeatherData.colorPush('#133778', i);
          } else if (formattedDate === 6) {
            WeatherData.colorPush('#FA6551', i);
          } else if (formattedDate >= 7 && formattedDate <= 11) {
            WeatherData.colorPush('#2A91CF', i);
          } else if (formattedDate >= 12 && formattedDate <= 15) {
            WeatherData.colorPush('#9DDEFF', i);
          } else if (formattedDate >= 16 && formattedDate <= 18) {
            WeatherData.colorPush('#2A91CF', i);
          } else if (formattedDate === 19) {
            WeatherData.colorPush('#FA6A67', i);
          } else if (formattedDate >= 20 && formattedDate <= 22) {
            WeatherData.colorPush('#133778', i);
          }
        }
      });
    }

  };
}).filter('Time', function () {
  return function (input) {
    var unUnixDate = new Date(input * 1000);
    var formattedDate = unUnixDate.getHours();
    if (formattedDate <= 23 && formattedDate >= 13) {
      var output = formattedDate - 12 + 'pm';
    } else if (formattedDate === 0) {
      var output = formattedDate + 12 + 'am';
    } else if (formattedDate === 12) {
      var output = formattedDate + 'pm';
    } else {
      var output = formattedDate + 'am';
    }
    return output;
  };
}).filter('Percent', function () {
  return function (input) {
    var output = input * 100;
    return output + '%';
    console.log(output);
  };
}).factory('Hacker', function ($http, paperBoy, $stateParams) {
  return {
    topNews: function topNews() {
      $http.get('https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty').then(function (result) {
        var idArray = result.data;
        angular.forEach(idArray, function (storyId, i) {
          if (i > 25) {
            return;
          }
          $http.get('https://hacker-news.firebaseio.com/v0/item/' + storyId + '.json?print=pretty').success(function (story) {
            paperBoy.dataPush(story);
          });
        });
      });
    },
    askStories: function askStories() {
      $http.get('https://hacker-news.firebaseio.com/v0/askstories.json?print=pretty').then(function (result) {
        var idArray = result.data;
        angular.forEach(idArray, function (storyId, i) {
          if (i > 25) {
            return;
          }
          $http.get('https://hacker-news.firebaseio.com/v0/item/' + storyId + '.json?print=pretty').success(function (ask) {
            paperBoy.askPush(ask);
          });
        });
      });
    },
    showStories: function showStories() {
      $http.get('https://hacker-news.firebaseio.com/v0/showstories.json?print=pretty').then(function (result) {
        var idArray = result.data;
        angular.forEach(idArray, function (storyId, i) {
          if (i > 25) {
            return;
          }
          $http.get('https://hacker-news.firebaseio.com/v0/item/' + storyId + '.json?print=pretty').success(function (show) {
            paperBoy.showPush(show);
          });
        });
      });
    }
  };
}).factory('Auth', function (FIRE_URL, $firebaseAuth) {
  var ref = new Firebase(FIRE_URL);
  return $firebaseAuth(ref);
}).factory('FB', function (FIRE_URL) {
  return {
    newFavorite: function newFavorite(news) {
      var ref = new Firebase(FIRE_URL + '/favorite');
      ref.push().set({
        id: news.id,
        author: news.by,
        time: news.time,
        title: news.title,
        url: news.url
      }, function (err) {
        if (err) {
          console.log('Error: ' + err);
        } else {
          console.log('Saved');
        }
      });
    }
  };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9qcy9mYWN0b3J5LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FFdEIsT0FBTyxDQUFDLFNBQVMsRUFBRSxVQUFXLFdBQVcsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRTtBQUM5RSxTQUFPOztBQUVMLFFBQUksRUFBRSxnQkFBVztBQUNmLFVBQUksR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNuRCxVQUFJLEtBQUssR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNsRCxVQUFJLEdBQUcsS0FBSyxLQUFLLEVBQUU7QUFDakIsV0FBRyxHQUFHLFNBQVMsQ0FBQTtPQUNoQixNQUFNLElBQUksR0FBRyxLQUFJLEtBQUssRUFBRTtBQUN2QixXQUFHLEdBQUcsV0FBVyxDQUFBO09BQ2xCLE1BQU0sSUFBSSxHQUFHLEtBQUksTUFBTSxFQUFFO0FBQ3hCLFdBQUcsR0FBRyxVQUFVLENBQUE7T0FDakIsTUFBTSxJQUFJLEdBQUcsS0FBSSxLQUFLLEVBQUU7QUFDdkIsV0FBRyxHQUFHLFFBQVEsQ0FBQTtPQUNmLE1BQU0sSUFBSSxHQUFHLEtBQUksS0FBSyxFQUFFO0FBQ3ZCLFdBQUcsR0FBRyxVQUFVLENBQUE7T0FDakIsTUFBTSxJQUFJLEdBQUcsS0FBSSxLQUFLLEVBQUU7QUFDdkIsV0FBRyxHQUFHLFFBQVEsQ0FBQTtPQUNmLE1BQU0sSUFBSSxHQUFHLEtBQUksS0FBSyxFQUFFO0FBQ3ZCLFdBQUcsR0FBRyxRQUFRLENBQUE7T0FDZjtBQUNELFVBQUksU0FBUyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFBOztBQUVqQyxpQkFBVyxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUE7S0FDbkM7O0FBRUQsY0FBVSxFQUFFLHNCQUFXO0FBQ3JCLFdBQUssQ0FDRixLQUFLLENBQUMsV0FBVyxHQUFHLFlBQVksQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLFlBQVksQ0FBQyxJQUFJLEdBQUcseUJBQXlCLENBQUMsQ0FDM0YsT0FBTyxDQUFDLFVBQVUsSUFBSSxFQUFDOztBQUV0QixtQkFBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBOztBQUU3RCxZQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQTs7QUFJaEMsYUFBSyxJQUFJLENBQUMsR0FBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBRXRDLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBTSxXQUFXLEVBQUU7QUFDdEMscUJBQVcsQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFBO1NBRW5DLE1BQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFJLGFBQWEsRUFBRTtBQUM3QyxxQkFBVyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUE7U0FFcEMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUksTUFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEtBQUcsTUFBTSxFQUFFO0FBQ3ZFLHFCQUFXLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUMsQ0FBQTtTQUV6QyxNQUFNLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sS0FBSyxZQUFZLEVBQUU7QUFDaEQscUJBQVcsQ0FBQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDLENBQUE7U0FFL0MsTUFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssTUFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEtBQUcsU0FBUyxFQUFFO0FBQzNFLHFCQUFXLENBQUMsUUFBUSxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxDQUFBO1NBRTVDLE1BQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFJLE1BQU0sRUFBRTtBQUN0QyxxQkFBVyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUE7U0FFekMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUksT0FBTyxFQUFFO0FBQ3ZDLHFCQUFXLENBQUMsUUFBUSxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxDQUFBO1NBRTVDLE1BQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFJLE1BQU0sRUFBRTtBQUN0QyxxQkFBVyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUE7U0FFcEMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUksS0FBSyxFQUFFO0FBQ3JDLHFCQUFXLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQTtTQUV4QyxNQUFNLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSSxRQUFRLEVBQUU7QUFDeEMscUJBQVcsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFBO1NBRXJDLE1BQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFJLG1CQUFtQixFQUFFO0FBQ25ELHFCQUFXLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQTtTQUV4QyxNQUFNLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSSxxQkFBcUIsRUFBRTtBQUNyRCxxQkFBVyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUE7U0FDekM7O0FBSUgsWUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUE7O0FBRWhDLGFBQUssSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQ3ZDLGNBQUksVUFBVSxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUUsSUFBSSxDQUFDLENBQUE7QUFDbEQsY0FBSSxhQUFhLEdBQUcsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDOztBQUU1QyxjQUFJLGFBQWEsSUFBSSxDQUFDLElBQUksYUFBYSxJQUFHLENBQUMsSUFBSSxhQUFhLEtBQUssRUFBRSxFQUFFO0FBQ2pFLHVCQUFXLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztXQUNyQyxNQUFNLElBQUksYUFBYSxJQUFHLENBQUMsSUFBSSxhQUFhLElBQUksQ0FBQyxFQUFDO0FBQ2pELHVCQUFXLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztXQUNyQyxNQUFNLElBQUksYUFBYSxLQUFLLENBQUMsRUFBRTtBQUM5Qix1QkFBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7V0FDckMsTUFBTSxJQUFJLGFBQWEsSUFBSSxDQUFDLElBQUksYUFBYSxJQUFHLEVBQUUsRUFBRTtBQUNuRCx1QkFBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7V0FDckMsTUFBTSxJQUFJLGFBQWEsSUFBSSxFQUFFLElBQUksYUFBYSxJQUFJLEVBQUUsRUFBQztBQUNwRCx1QkFBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7V0FDckMsTUFBTSxJQUFJLGFBQWEsSUFBSSxFQUFFLElBQUksYUFBYSxJQUFJLEVBQUUsRUFBQztBQUNwRCx1QkFBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7V0FDckMsTUFBTSxJQUFJLGFBQWEsS0FBSyxFQUFFLEVBQUM7QUFDOUIsdUJBQVcsQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1dBQ3JDLE1BQU0sSUFBSSxhQUFhLElBQUksRUFBRSxJQUFJLGFBQWEsSUFBSSxFQUFFLEVBQUM7QUFDcEQsdUJBQVcsQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1dBQ3JDO1NBQ0o7T0FFRixDQUFDLENBQUE7S0FHSDs7R0FFRixDQUFBO0NBQ0EsQ0FBQyxDQUVELE1BQU0sQ0FBQyxNQUFNLEVBQUUsWUFBWTtBQUM1QixTQUFPLFVBQVMsS0FBSyxFQUFFO0FBQ25CLFFBQUksVUFBVSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssR0FBQyxJQUFJLENBQUMsQ0FBQTtBQUNyQyxRQUFJLGFBQWEsR0FBRyxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDeEMsUUFBSSxhQUFhLElBQUksRUFBRSxJQUFJLGFBQWEsSUFBSSxFQUFFLEVBQUU7QUFDOUMsVUFBSSxNQUFNLEdBQUcsYUFBYSxHQUFDLEVBQUUsR0FBRyxJQUFJLENBQUE7S0FDckMsTUFBTSxJQUFJLGFBQWEsS0FBSyxDQUFDLEVBQUM7QUFDN0IsVUFBSSxNQUFNLEdBQUcsYUFBYSxHQUFDLEVBQUUsR0FBRyxJQUFJLENBQUE7S0FDckMsTUFBTSxJQUFJLGFBQWEsS0FBSyxFQUFFLEVBQUM7QUFDOUIsVUFBSSxNQUFNLEdBQUcsYUFBYSxHQUFHLElBQUksQ0FBQTtLQUNsQyxNQUFNO0FBQ0wsVUFBSSxNQUFNLEdBQUcsYUFBYSxHQUFHLElBQUksQ0FBQTtLQUNsQztBQUNELFdBQU8sTUFBTSxDQUFDO0dBQ2YsQ0FBQTtDQUNKLENBQUMsQ0FFRCxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVk7QUFDL0IsU0FBTyxVQUFTLEtBQUssRUFBRTtBQUNuQixRQUFJLE1BQU0sR0FBRyxLQUFLLEdBQUcsR0FBRyxDQUFBO0FBQ3hCLFdBQU8sTUFBTSxHQUFHLEdBQUcsQ0FBQTtBQUNuQixXQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0dBQ3RCLENBQUE7Q0FDQSxDQUFDLENBRUQsT0FBTyxDQUFDLFFBQVEsRUFBRSxVQUFVLEtBQUssRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFO0FBQzFELFNBQU87QUFDTCxXQUFPLEVBQUUsbUJBQVk7QUFDbkIsV0FBSyxDQUNKLEdBQUcsQ0FBQyxvRUFBb0UsQ0FBQyxDQUN6RSxJQUFJLENBQUMsVUFBUyxNQUFNLEVBQUU7QUFDckIsWUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQTtBQUN6QixlQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxVQUFVLE9BQU8sRUFBRSxDQUFDLEVBQUU7QUFDN0MsY0FBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO0FBQUMsbUJBQU07V0FBQztBQUNwQixlQUFLLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxHQUFHLE9BQU8sR0FBRyxvQkFBb0IsQ0FBQyxDQUN0RixPQUFPLENBQUMsVUFBUyxLQUFLLEVBQUU7QUFDdkIsb0JBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7V0FDekIsQ0FBQyxDQUFBO1NBQ0wsQ0FBQyxDQUFBO09BQ0gsQ0FBQyxDQUFBO0tBQ0g7QUFDRCxjQUFVLEVBQUUsc0JBQVk7QUFDdEIsV0FBSyxDQUNKLEdBQUcsQ0FBQyxvRUFBb0UsQ0FBQyxDQUN6RSxJQUFJLENBQUMsVUFBUyxNQUFNLEVBQUU7QUFDckIsWUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQTtBQUN6QixlQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxVQUFVLE9BQU8sRUFBRSxDQUFDLEVBQUU7QUFDN0MsY0FBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO0FBQUMsbUJBQU07V0FBQztBQUNwQixlQUFLLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxHQUFHLE9BQU8sR0FBRyxvQkFBb0IsQ0FBQyxDQUN0RixPQUFPLENBQUMsVUFBUyxHQUFHLEVBQUU7QUFDckIsb0JBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7V0FDdEIsQ0FBQyxDQUFBO1NBQ0wsQ0FBQyxDQUFBO09BQ0gsQ0FBQyxDQUFBO0tBQ0g7QUFDRCxlQUFXLEVBQUUsdUJBQVk7QUFDdkIsV0FBSyxDQUNKLEdBQUcsQ0FBQyxxRUFBcUUsQ0FBQyxDQUMxRSxJQUFJLENBQUMsVUFBUyxNQUFNLEVBQUU7QUFDckIsWUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQTtBQUN6QixlQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxVQUFVLE9BQU8sRUFBRSxDQUFDLEVBQUU7QUFDN0MsY0FBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO0FBQUMsbUJBQU07V0FBQztBQUNwQixlQUFLLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxHQUFHLE9BQU8sR0FBRyxvQkFBb0IsQ0FBQyxDQUN0RixPQUFPLENBQUMsVUFBUyxJQUFJLEVBQUU7QUFDdEIsb0JBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUE7V0FDeEIsQ0FBQyxDQUFBO1NBQ0wsQ0FBQyxDQUFBO09BQ0gsQ0FBQyxDQUFBO0tBQ0g7R0FDRixDQUFBO0NBQ0YsQ0FBQyxDQUNELE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBVSxRQUFRLEVBQUUsYUFBYSxFQUFFO0FBQ2hELE1BQUksR0FBRyxHQUFHLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2pDLFNBQU8sYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQzdCLENBQUMsQ0FFRCxPQUFPLENBQUMsSUFBSSxFQUFFLFVBQVUsUUFBUSxFQUFFO0FBQ2pDLFNBQU87QUFDTCxlQUFXLEVBQUUscUJBQVMsSUFBSSxFQUFFO0FBQzFCLFVBQUksR0FBRyxHQUFHLElBQUksUUFBUSxDQUFDLFFBQVEsR0FBRyxXQUFXLENBQUMsQ0FBQztBQUMvQyxTQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDO0FBQ2IsVUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFO0FBQ1gsY0FBTSxFQUFFLElBQUksQ0FBQyxFQUFFO0FBQ2YsWUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO0FBQ2YsYUFBSyxFQUFFLElBQUksQ0FBQyxLQUFLO0FBQ2pCLFdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztPQUNkLEVBQUUsVUFBVSxHQUFHLEVBQUU7QUFDaEIsWUFBSSxHQUFHLEVBQUU7QUFDUCxpQkFBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUUsR0FBRyxDQUFDLENBQUM7U0FDN0IsTUFBTTtBQUNMLGlCQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO1NBQ3JCO09BQ0YsQ0FBQyxDQUFDO0tBQ0o7R0FDRixDQUFDO0NBQ0gsQ0FBQyxDQUFDIiwiZmlsZSI6InNyYy9qcy9mYWN0b3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3N3aXNzJylcblxuLmZhY3RvcnkoJ1dlYXRoZXInLCBmdW5jdGlvbiAoIFdlYXRoZXJEYXRhLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCBXRUFUSEVSX1VSTCkge1xucmV0dXJuIHtcblxuICBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZGF5ID0gbmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKS5zdWJzdHJpbmcoMCwgMylcbiAgICB2YXIgbW9udGggPSBuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpLnN1YnN0cmluZygzKVxuICAgIGlmIChkYXkgPT09ICdUdWUnKSB7XG4gICAgICBkYXkgPSAnVHVlc2RheSdcbiAgICB9IGVsc2UgaWYgKGRheSA9PT0nV2VkJykge1xuICAgICAgZGF5ID0gJ1dlZG5lc2RheSdcbiAgICB9IGVsc2UgaWYgKGRheSA9PT0nVGh1cicpIHtcbiAgICAgIGRheSA9ICdUaHVyc2RheSdcbiAgICB9IGVsc2UgaWYgKGRheSA9PT0nRnJpJykge1xuICAgICAgZGF5ID0gJ0ZyaWRheSdcbiAgICB9IGVsc2UgaWYgKGRheSA9PT0nU2F0Jykge1xuICAgICAgZGF5ID0gJ1NhdHVyZGF5J1xuICAgIH0gZWxzZSBpZiAoZGF5ID09PSdTdW4nKSB7XG4gICAgICBkYXkgPSAnU3VuZGF5J1xuICAgIH0gZWxzZSBpZiAoZGF5ID09PSdNb24nKSB7XG4gICAgICBkYXkgPSAnTW9uZGF5J1xuICAgIH1cbiAgICB2YXIgZGF0ZW1vbnRoID0gZGF5ICsgJywnICsgbW9udGhcblxuICAgIFdlYXRoZXJEYXRhLmZvcm1hdGRhdGUgPSBkYXRlbW9udGhcbiAgfSxcblxuICBnZXRXZWF0aGVyOiBmdW5jdGlvbigpIHtcbiAgICAkaHR0cFxuICAgICAgLmpzb25wKFdFQVRIRVJfVVJMICsgJHN0YXRlUGFyYW1zLmxhdCArICcsJyArICRzdGF0ZVBhcmFtcy5sb25nICsgJz9jYWxsYmFjaz1KU09OX0NBTExCQUNLJylcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKXtcblxuICAgICAgICBXZWF0aGVyRGF0YS5kYXRhUHVzaChkYXRhLmN1cnJlbnRseSwgZGF0YS5kYWlseSwgZGF0YS5ob3VybHkpIFxuICAgICAgICBcbiAgICAgICAgdmFyIGljb25GcmFtZSA9IGRhdGEuaG91cmx5LmRhdGFcblxuXG5cbiAgICAgICAgZm9yICh2YXIgaSA9MDsgaSA8IGljb25GcmFtZS5sZW5ndGg7IGkrKylcblxuICAgICAgICAgIGlmIChpY29uRnJhbWVbaV0uaWNvbiAgPT09ICdjbGVhci1kYXknKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnc3VuLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdjbGVhci1uaWdodCcpIHtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmljb25QdXNoKCdtb29uLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdyYWluJyAmJiBpY29uRnJhbWVbaV0uc3VtbWFyeT09PSdSYWluJykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkUmFpbi5zdmcnLCBpKVxuXG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uRnJhbWVbaV0uc3VtbWFyeSA9PT0gJ0xpZ2h0IFJhaW4nKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnY2xvdWREcml6emxlQWx0LnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSAncmFpbicgJiYgaWNvbkZyYW1lW2ldLnN1bW1hcnk9PT0nRHJpenpsZScpIHtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmljb25QdXNoKCdjbG91ZERyaXp6bGUuc3ZnJywgaSlcblxuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbkZyYW1lW2ldLmljb24gPT09J3Nub3cnKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnY2xvdWRTbm93LnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdzbGVldCcpIHtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmljb25QdXNoKCdjbG91ZFNub3dBbHQuc3ZnJywgaSlcblxuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbkZyYW1lW2ldLmljb24gPT09J3dpbmQnKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnd2luZC5zdmcnLCBpKVxuXG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uRnJhbWVbaV0uaWNvbiA9PT0nZm9nJykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkRm9nLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdjbG91ZHknKSB7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5pY29uUHVzaCgnY2xvdWQuc3ZnJywgaSlcblxuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbkZyYW1lW2ldLmljb24gPT09J3BhcnRseS1jbG91ZHktZGF5Jykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkU3VuLnN2ZycsIGkpXG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25GcmFtZVtpXS5pY29uID09PSdwYXJ0bHktY2xvdWR5LW5pZ2h0Jykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuaWNvblB1c2goJ2Nsb3VkTW9vbi5zdmcnLCBpKVxuICAgICAgICAgIH1cblxuICAgICAgICBcblxuICAgICAgICB2YXIgY29sb3JUaW1lID0gZGF0YS5ob3VybHkuZGF0YVxuXG4gICAgICAgIGZvciAodmFyIGk9MDsgaSA8IGNvbG9yVGltZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciB1blVuaXhEYXRlID0gbmV3IERhdGUoY29sb3JUaW1lW2ldLnRpbWUgKjEwMDApXG4gICAgICAgICAgdmFyIGZvcm1hdHRlZERhdGUgPSB1blVuaXhEYXRlLmdldEhvdXJzKCk7XG5cbiAgICAgICAgaWYgKGZvcm1hdHRlZERhdGUgPj0gMCAmJiBmb3JtYXR0ZWREYXRlIDw9MiB8fCBmb3JtYXR0ZWREYXRlID09PSAyMykge1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuY29sb3JQdXNoKCcjMDcxODI2JywgaSk7IFxuICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA+PTMgJiYgZm9ybWF0dGVkRGF0ZSA8PSA1KXtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmNvbG9yUHVzaCgnIzEzMzc3OCcsIGkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA9PT0gNiApe1xuICAgICAgICAgICAgV2VhdGhlckRhdGEuY29sb3JQdXNoKCcjRkE2NTUxJywgaSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXR0ZWREYXRlID49IDcgJiYgZm9ybWF0dGVkRGF0ZSA8PTExICl7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5jb2xvclB1c2goJyMyQTkxQ0YnLCBpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdHRlZERhdGUgPj0gMTIgJiYgZm9ybWF0dGVkRGF0ZSA8PSAxNSl7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5jb2xvclB1c2goJyM5RERFRkYnLCBpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdHRlZERhdGUgPj0gMTYgJiYgZm9ybWF0dGVkRGF0ZSA8PSAxOCl7XG4gICAgICAgICAgICBXZWF0aGVyRGF0YS5jb2xvclB1c2goJyMyQTkxQ0YnLCBpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdHRlZERhdGUgPT09IDE5KXtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmNvbG9yUHVzaCgnI0ZBNkE2NycsIGkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA+PSAyMCAmJiBmb3JtYXR0ZWREYXRlIDw9IDIyKXtcbiAgICAgICAgICAgIFdlYXRoZXJEYXRhLmNvbG9yUHVzaCgnIzEzMzc3OCcsIGkpOyBcbiAgICAgICAgICB9IFxuICAgICAgfVxuXG4gICAgfSlcblxuXG4gIH1cblxufVxufSlcblxuLmZpbHRlcignVGltZScsIGZ1bmN0aW9uICgpIHtcbnJldHVybiBmdW5jdGlvbihpbnB1dCkge1xuICAgIHZhciB1blVuaXhEYXRlID0gbmV3IERhdGUoaW5wdXQqMTAwMClcbiAgICB2YXIgZm9ybWF0dGVkRGF0ZSA9IHVuVW5peERhdGUuZ2V0SG91cnMoKTtcbiAgICAgIGlmIChmb3JtYXR0ZWREYXRlIDw9IDIzICYmIGZvcm1hdHRlZERhdGUgPj0gMTMpIHtcbiAgICAgICAgdmFyIG91dHB1dCA9IGZvcm1hdHRlZERhdGUtMTIgKyAncG0nXG4gICAgICB9IGVsc2UgaWYgKGZvcm1hdHRlZERhdGUgPT09IDApe1xuICAgICAgICB2YXIgb3V0cHV0ID0gZm9ybWF0dGVkRGF0ZSsxMiArICdhbSdcbiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkRGF0ZSA9PT0gMTIpe1xuICAgICAgICB2YXIgb3V0cHV0ID0gZm9ybWF0dGVkRGF0ZSArICdwbSdcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBvdXRwdXQgPSBmb3JtYXR0ZWREYXRlICsgJ2FtJ1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG59KVxuXG4uZmlsdGVyKCdQZXJjZW50JywgZnVuY3Rpb24gKCkge1xucmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgdmFyIG91dHB1dCA9IGlucHV0ICogMTAwXG4gICAgcmV0dXJuIG91dHB1dCArICclJ1xuICAgIGNvbnNvbGUubG9nKG91dHB1dClcbn1cbn0pXG5cbi5mYWN0b3J5KCdIYWNrZXInLCBmdW5jdGlvbiAoJGh0dHAsIHBhcGVyQm95LCAkc3RhdGVQYXJhbXMpIHtcbiAgcmV0dXJuIHtcbiAgICB0b3BOZXdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAkaHR0cFxuICAgICAgLmdldCgnaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC90b3BzdG9yaWVzLmpzb24/cHJpbnQ9cHJldHR5JylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICB2YXIgaWRBcnJheSA9IHJlc3VsdC5kYXRhXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpZEFycmF5LCBmdW5jdGlvbiAoc3RvcnlJZCwgaSkge1xuICAgICAgICAgIGlmIChpID4gMjUpIHtyZXR1cm59XG4gICAgICAgICAgJGh0dHAuZ2V0KCdodHRwczovL2hhY2tlci1uZXdzLmZpcmViYXNlaW8uY29tL3YwL2l0ZW0vJyArIHN0b3J5SWQgKyAnLmpzb24/cHJpbnQ9cHJldHR5JylcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHN0b3J5KSB7XG4gICAgICAgICAgICAgIHBhcGVyQm95LmRhdGFQdXNoKHN0b3J5KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICBhc2tTdG9yaWVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAkaHR0cFxuICAgICAgLmdldCgnaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9hc2tzdG9yaWVzLmpzb24/cHJpbnQ9cHJldHR5JylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICB2YXIgaWRBcnJheSA9IHJlc3VsdC5kYXRhXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpZEFycmF5LCBmdW5jdGlvbiAoc3RvcnlJZCwgaSkge1xuICAgICAgICAgIGlmIChpID4gMjUpIHtyZXR1cm59XG4gICAgICAgICAgJGh0dHAuZ2V0KCdodHRwczovL2hhY2tlci1uZXdzLmZpcmViYXNlaW8uY29tL3YwL2l0ZW0vJyArIHN0b3J5SWQgKyAnLmpzb24/cHJpbnQ9cHJldHR5JylcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGFzaykge1xuICAgICAgICAgICAgICBwYXBlckJveS5hc2tQdXNoKGFzaylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0sXG4gICAgc2hvd1N0b3JpZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICRodHRwXG4gICAgICAuZ2V0KCdodHRwczovL2hhY2tlci1uZXdzLmZpcmViYXNlaW8uY29tL3YwL3Nob3dzdG9yaWVzLmpzb24/cHJpbnQ9cHJldHR5JylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICB2YXIgaWRBcnJheSA9IHJlc3VsdC5kYXRhXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpZEFycmF5LCBmdW5jdGlvbiAoc3RvcnlJZCwgaSkge1xuICAgICAgICAgIGlmIChpID4gMjUpIHtyZXR1cm59XG4gICAgICAgICAgJGh0dHAuZ2V0KCdodHRwczovL2hhY2tlci1uZXdzLmZpcmViYXNlaW8uY29tL3YwL2l0ZW0vJyArIHN0b3J5SWQgKyAnLmpzb24/cHJpbnQ9cHJldHR5JylcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHNob3cpIHtcbiAgICAgICAgICAgICAgcGFwZXJCb3kuc2hvd1B1c2goc2hvdylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cbiAgfVxufSlcbi5mYWN0b3J5KCdBdXRoJywgZnVuY3Rpb24gKEZJUkVfVVJMLCAkZmlyZWJhc2VBdXRoKSB7XG4gICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFX1VSTCk7XG4gICAgcmV0dXJuICRmaXJlYmFzZUF1dGgocmVmKTtcbn0pXG5cbi5mYWN0b3J5KCdGQicsIGZ1bmN0aW9uIChGSVJFX1VSTCkge1xuICByZXR1cm4ge1xuICAgIG5ld0Zhdm9yaXRlOiBmdW5jdGlvbihuZXdzKSB7XG4gICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVfVVJMICsgJy9mYXZvcml0ZScpO1xuICAgICAgcmVmLnB1c2goKS5zZXQoe1xuICAgICAgICBpZDogbmV3cy5pZCxcbiAgICAgICAgYXV0aG9yOiBuZXdzLmJ5LFxuICAgICAgICB0aW1lOiBuZXdzLnRpbWUsXG4gICAgICAgIHRpdGxlOiBuZXdzLnRpdGxlLFxuICAgICAgICB1cmw6IG5ld3MudXJsXG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3I6ICcrIGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1NhdmVkJylcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xufSk7XG5cbiJdfQ==
